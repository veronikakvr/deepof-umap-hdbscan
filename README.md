# Animal behaviour Clustering pipeline - Social/Single Open Field Round
This repository provides a modular Python pipeline for unsupervised identification and analysis of behavioural states from animal time-series data. Suitable for raw DeepOF output of short recordings of Single/Social Round Open Field Set Up.
The pipeline uses UMAP for dimensionality reduction, HDBSCAN for clustering, and includes robust statistical assessment and visualisations.

Compatible with data generated by the masterfile generator.

## Features
- **Data cleaning, aggregation, and imputation**
- **Flexible time-binning for longer datasets**
- **UMAP embedding and HDBSCAN clustering**
- **Automatic cluster quality assessment**
- **Non-parametric (Kruskal-Wallis), post-hoc Dunn's test**
- **Clustered behavioural profile visualisation**
- **Commented modular code for easy adaptation**
- **Violin and scatter plots with annotations**


## Installation
1. **Create a conda environment**
   conda create -n analysis python=3.9.23
2. **Clone this repo**
   git clone https://github.com/veronikakvr/deepof-umap-hdbscan/behavioural-cluster-pipeline.git

3. **Instal dependencies**
pip install -r requirements.txt

**Essential packages - versions:**
python = 3.9.23
numpy = 2.0.2
scipy = 1.13.1
pandas
matplotlib
seaborn
umap-learn
hdbscan
scikit-learn
scikit-posthocs
statsmodels

**Ensure the above mentioned packages are at these exact versions as downgrading/upgrading will affect the HDBSCAN clustering performance.**

---
## Workflow Overview

1. **Prepare input CSVs:**
  Format: one file for females, one for males. Must contain columns:
      - 'experimental_id', 'Time',  all behavioural feature columns (see script)

2. **Update paths in 'behavioural_cluster_pipeline.py'**

3. **Run the pipeline**
    Either python behavioural_cluster_pipeline.py
    or operate with a dynamic version in Jupyter Lab or Visual Studio (highly recommended for exploratory work)
   
4. **Results**
   - Cluster validation indices printed to the terminal
  
---

## Customization Tips
- **To analyse different features:**
    Update the 'behavior_cols' list at the top of the script
- **To change cluster parameters:**
    Adjust min_cluster_size and UMAP parameters in the script as needed. Might need to play around with it to find the perfect match for your datasets.

## Citing
If you use this pipeline in your research plese cite this repository and teh following key dependencies:

- [UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction (McInnes et al., 2018)] (https://arxiv.org/abs/1802.03426)
- [HDBSCAN: Hierarchical density-based clustering (Campello et al., 2013)] (https://jmlr.org/papers/volume17/16-304/16-304.pdf)

## License
MIT License




#created by Veronika Kovarova, 2025
