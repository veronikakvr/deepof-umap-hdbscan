# Animal Behaviour Clustering Pipeline - Social/Single Open Field Round

This repository provides a modular Python pipeline for unsupervised identification and analysis of behavioural states from animal time-series data. It is suited for raw DeepOF output of short recordings from Single/Social Round Open Field Setups.

The pipeline uses **UMAP** for dimensionality reduction, **HDBSCAN** for clustering, and includes robust statistical assessment and visualizations.

**Compatible with data generated by the masterfile generator.**

## Workflow Overview

1. **Prepare input data with the masterfile generator:**

   - Start with raw DeepOF output files containing second-to-second behavioral annotations.
   - Organize these raw files in a folder.
   - Run the **`masterfilecreator_deepof8.ipynb`** in this folder to generate properly formatted masterfiles.
   - The output will include a `_FINAL` file, which is correctly formatted and ready for the clustering pipeline.

2. **Use the generated `_FINAL` masterfile as input for this clustering pipeline.**

3. **Run the Installation (info below)**

4. **Ensure the correct environment setup:**

   - Verify the `requirements.txt` matches your Python environment versions.
   - The pipeline requires **Python 3.9.23** and specific package versions for reliable clustering performance.

5. **Update paths in `UMAP_HDBSCAN_Interactive.ipynb`** to point to your `_FINAL` masterfile and relevant filtering parameters.

6. **Run the clustering pipeline:**

   - via Jupyter Notebook - play around with the parameters

## Installation

1. **Create conda environment:**
conda create -n analysis python=3.9.23
conda activate analysis

2. **Clone this repository:**
     ```
     git clone https://github.com/veronikakvr/deepof-umap-hdbscan.git
     ```


3. **Install dependencies:**

     ```
     pip install -r requirements.txt
     ```

**Essential package versions:**

- python = 3.9.23  
- numpy = 2.0.2  
- scipy = 1.13.1  
- pandas  
- matplotlib  
- seaborn  
- umap-learn  
- hdbscan  
- scikit-learn  
- scikit-posthocs  
- statsmodels  

*Ensure these exact package versions to maintain HDBSCAN clustering performance.*

## Features

- **Data cleaning, aggregation, and imputation**
- **Flexible time-binning for longer datasets**
- **UMAP embedding and HDBSCAN clustering**
- **Automatic cluster quality assessment**
- **Non-parametric Kruskal-Wallis and post-hoc Dunn's tests**
- **Clustered behavioural profile visualization**
- **Commented modular code for easy adaptation**
- **Violin and scatter plots with annotations**

## Usage Tips

- To analyze different features, update the `behavior_cols` list at the top of `behavioural_cluster_pipeline.py`.
- Adjust cluster parameters such as `min_cluster_size` and UMAP settings in the script as needed to best fit your dataset.

## Results

- Cluster validation metrics are printed in the notebook output.
- Visualizations include violin plots and scatter UMAP embeddings colored by clusters.

## Citing

Please cite this repository and the following key methods used when publishing results from this pipeline:

- UMAP: [Uniform Manifold Approximation and Projection (McInnes et al., 2018)](https://arxiv.org/abs/1802.03426)  
- HDBSCAN: [Hierarchical density-based clustering (Campello et al., 2013)](https://jmlr.org/papers/volume17/16-304/16-304.pdf)

## License

MIT License

---

*Created by Veronika Kovarova, 2025*
